\documentclass[11pt]{article}
\usepackage[utf8]{inputenc}
\usepackage[a4paper,width=170mm,top=25mm,bottom=25mm,bindingoffset=6mm]{geometry}
\usepackage[spanish]{babel}
\usepackage[T1]{fontenc}
\usepackage{graphicx}
\usepackage{longtable}
\usepackage{amsmath}
\usepackage{booktabs}
\usepackage{rotating}
\usepackage{amssymb}

\addto\captionsspanish{%
    \def\tablename{Tabla}%
}

\graphicspath{ {figuras/} }

\title{Estudio de convergencia}
\author{}
\date{}


\begin{document}

\maketitle

% \section{Puerto de admisión}

%En la Figura \ref{fig:flujometrias} se indican los puntos donde se va a ensayar
%el puerto de admisión con el fin de obtener el valor de caudal másico que fluja
%por el puerto en distintas posiciones del rotor y a distintas velocidades de
%rotación.
%%
%Se obtendrá un mapa de caudal másico en función de una diferencia de presión
%($\Delta P$) y apertura del puerto ($lv$), este mapa se luego se transforma en
%un mapa de de coeficiente de descarga $(Cd)$ que es el resultado final buscado,
%$Cd = f(Lv, \Delta P)$.


% \begin{sidewaysfigure}
%     \includegraphics[width=1\textwidth]{flujometrias_admision.png}
%     \caption{Flujometrías para el puerto de Admisión}
%     \label{fig:flujometrias}
% \end{sidewaysfigure}

% \begin{table}
%     \centering
%     \begin{tabular}{rll} \toprule
%         Caso & Ángulos & Velocidades (rpm) \\ \midrule
%         0 & -10, 110 & 1000, 2000, 3000, 7000, 8000\\
%         1 & 0, 120 & 2000, 7000\\
%         2 & 10, 130 & 2000, 7000\\
%         3 & 50, 170 & 3000, 7000, 9000\\
%         4 & 60, 180 & 3000, 5000, 6000, 7000\\
%         5 & 95 & 1000, 7000\\ \bottomrule
%     \end{tabular}
%     \caption{Flujometrías a realizar}
%     \label{tab:casos}
% \end{table}

% Como se ve en la Figura \ref{fig:flujometrias}, los puntos a evaluar son los
% listados en la Tabla \ref{tab:casos}.

%Para determinar el tipo de \emph{solver} a utilizar se hace una primer corrida
%de cada caso asumiendo que el flujo se puede asumir como incompresible, es
%decir, que el número de Mach máximo del caso convergido va a ser menor a 0.3.
%%
%Se dice que el caso converge cuando el flujo másico a través de cualquiera de
%las entradas/salidas del dominio se estabiliza.

% \begin{table}
%     \centering
%     \begin{tabular}{rll}\toprule
%         Caso & Velocidad [RPM] & $Ma_{max}$ \\ \midrule
%         0 & 1000 & 0.29 \\
%         0 & 2000 & 0.65 \\
%         0 & 3000 & 0.49 \\
%         0 & 7000 & 0.65 \\
%         0 & 8000 & 0.23 \\
%         1 & 2000 & 0.14 \\
%         1 & 7000 & 0.4 \\
%         2 & 2000 & 0.1 \\
%         2 & 7000 & 0.43 \\
%         3 & 3000 & 0.16 \\
%         3 & 7000 & 0.37 \\
%         3 & 9000 & 0.24 \\
%         4 & 3000 & 0.35 \\
%         4 & 5000 & 0.38 \\
%         4 & 6000 & 0.49 \\
%         4 & 7000 & 0.63 \\
%         5 & 1000 & 0.01 \\
%         5 & 7000 & 0.45 \\ \bottomrule
%     \end{tabular}
%     \label{tab:mach}
%     \caption{Números de Mach}
% \end{table}

% En la Tabla \ref{tab:mach} se muestran los resultados preliminrares, donde
% se asumió $Ma<0.3$, para establerec el tipo de \emph{solver} a utilizar.

% \subsection{Descripción general de los casos}
% \subsubsection{Con solape de cámaras}

%En la figura \ref{fig:geom} se muestra un corte del puerto con
%un plano cuya normal está en z, se denominará a la cámara que esté a la izquierda
%como cámara 0 y a la que esté a la derecha cámara 1
%%
%Al haber solape de cámaras para definir la presión del puerto y estimar las
%condiciones iniciales de los parámetros viscosos que requiere el modelo
%$k-\epsilon$ se utilizan valores medios de presión, velocidad y temperatura de
%ambas cámaras.
%%

% \begin{figure}
%     \includegraphics[width=0.8\textwidth]{caso_1-cc.png}
%     \caption{Condiciones de borde}
%     \label{fig:geom}
% \end{figure}

% % En la tabla \ref{tab:cc} se listan los valores iniciales y presión media del
% % puerto obtenidos.
% \begin{table}
%     \centering
%     \begin{tabular}{rl} \toprule
%         Parámetro & Valor \\ \midrule
%         $\epsilon_{est}$ & 2547.815863 \\
%         $\gamma_{est}$ & 1.337 \\
%         $\kappa_{est}$ & 7.557217 \\
%         $\nu_{est}$ & 2.2e-05 \\
%         $P_0$ & 110678.78 Pa \\
%         $P_1$ & 111931.12 Pa \\
%         $\overline{P_{puerto}}$ & 111463.4 Pa \\
%         $\overline{\rho}$ & 0.974005 $kg/m^3$\\
%         $\overline{T}$ & 399.83 K \\ \bottomrule
%     \end{tabular}
%     \label{tab:cc}
%     \caption{Condiciones de contorno}
% \end{table}

% Dentro del volumen de control, el campo de presiones se inicializa con con el
% valor medio de presiones de las cámaras y el campo de velocidades se hace
% inicialmente (0,0,0).


\section{Introducción}

Un estudio de convergencia de malla es una herramienta para evaluar los errores
de discretización espacial de un estudio de CFD y consiste básicamente en:

\begin{enumerate}
    %
    \item Seleccionar un indicador del tamaño de malla $h$.
    %
    \item Elegir un indicador de la convergencia de malla $f$, suele ser la
        variable de estudio.
    %
    \item Seleccionar un coeficiente de refinamiento $r$ y realizar un mínimo
        de 3 simulaciones, manteniendo $r$ constante.
    %
    \item Calcular el orden de convergencia de la serie de datos $p$.
    %
    \item Estimar $f_{h=0}$
    %
    \item Calcular el Índice de Convergencia de Malla (GCI por sus siglas en
        inglés).
    %
    \item Comprobar que se está dentro del rango asintótico de convergencia.
    %
\end{enumerate}

El error de discretización surge de aplicar las ecuaciones de gobierno a un
dominio espacial discreto conocido como malla.
%
A medida que se reduce el tamaño de celda, el resultado del estudio de CFD se
vuelve menos sensible a mayores refinamientos y es esperable que el error de
discretización tienda asintóticamente a cero cuando el tamaño de la malla
tiende a cero.

En la Figura \ref{fig:flujometrias} y la Tabla \ref{tab:casos} se indican los
puntos donde se va a ensayar el puerto de admisión con el fin de obtener el
valor de caudal másico o volumétrico que fluja por el puerto en distintas
posiciones del rotor y a distintas velocidades de rotación.
%
Dada la cantidad de flujometrías a realizar se opta por realizar el estudio de
convergencia solo en algunos de los casos, los cuales serán utilizados como
referencia e indicarán el nivel mínimo de refinamiento mínimo necesario a
utilizar para todos los casos.

\begin{sidewaysfigure}
    \includegraphics[width=1\textwidth]{flujometrias_admision.png}
    \caption{Flujometrías para el puerto de admisión}
    \label{fig:flujometrias}
\end{sidewaysfigure}

\begin{table}
    \centering
    \begin{tabular}{rll} \toprule
        Caso & Ángulos & Velocidades (rpm) \\ \midrule
        0 & -10, 110 & 1000, 2000, 3000, 7000, 8000\\
        1 & 0, 120 & 2000, 7000\\
        2 & 10, 130 & 2000, 7000\\
        3 & 50, 170 & 3000, 7000, 9000\\
        4 & 60, 180 & 3000, 5000, 6000, 7000\\
        5 & 95 & 1000, 7000\\ \bottomrule
    \end{tabular}
    \caption{Flujometrías para el puerto de admisión}
    \label{tab:casos}
\end{table}

Hay que distinguir en entre los refinamientos necesarios de flujometrías en
régimen compresible e incompresible, los casos a tomar como referencia son el
0, 4 y 5.

\subsection{Selección de $h$, $r$ y $f$}
%
El procedimiento para generar la malla consiste en crear una malla inicial con
la utilidad \emph{blockMesh} la cual es un punto de partida para
\emph{snappyHexMesh}.
%
Se busca que la malla creada por \emph{blockMesh} sea de celdas cúbicas, el
lado de estas celdas es el que se toma como indicador del tamaño de malla $h$.
%
El coeficiente de refinamiento es el cociente entre el tamaño $h$ como se
indica en la ecuación \ref{eq:r}, el mismo se toma igual a 2 y se mantiene
constante para todos los refinamientos.

\begin{equation} \label{eq:r}
    r = \frac{h_{i+1}}{h_{i}}
\end{equation}

\begin{figure}
    \centering
    \includegraphics{celdas_block_mesh.png}
    \caption{Refinamiento con $r=2$}
    \label{fig:celdas_bm}
\end{figure}

Para verificar la convergencia de malla se utilizará el flujo másico a través
de las superficies definidas como entrada/salida de cámaras, en caso de que
%
En la figura \ref{fig:parches} se indican con nombre las superficies por las
cuales hay flujo másico.
%
En caso de flujo de $Ma < 0.3$, el \emph{solver} devuelve el flujo volumétrico,
por lo que se usa este como indicador.

\begin{figure}
    \centering
    \includegraphics[width=0.4\textwidth]{nombres-parches.png}
    \label{fig:parches}
    \caption{Vista superior del volumen de control}
\end{figure}

\subsection{Orden de convergencia}
%
El orden de convergencia $p$ indica que tan rápido se acerca una secuencia a un
límite.
%
Una secuencia ${x_n}$ que converge a $x^*$ tiene orden de convergencia $p \ge
1$ y constante asintótica de error $\mu$.

\begin{equation}
    \lim_{n\rightarrow \infty} \frac{|x_{n+1} - x^*|} {|x_{n} - x^*|^p} = \mu
\end{equation}

El orden de convergencia se puede obtener de comparando el comportamiento del
error, definido como la diferencia ente la solución exacta o del continuo y la
discreta.

\begin{equation}
    E = f(h) - f_{exacta} = Ch^p + \xi
    \label{eq:1}
\end{equation}

Dónde $C$ es una constante, $h$ es una medida del nivel de refinamiento de la
malla, $p$ es el orden de convergencia y $\xi$ son términos de orden superior.
%
Despreciando los términos de orden superior $\xi$ y tomando logaritmo a ambos
lados, se puede expresar la ecuación \ref{eq:1} como:

\begin{equation}
    \log(E) = \log(C) + p \cdot \log(h)
\end{equation}

De esta forma $p$ es la pendiente de la curva de $\log(E)=f(\log(h))$ y
conociendo al menos 3 puntos puede calcular $p$ como:

\begin{equation}
p = \ln \left( \frac{ f_3 - f_2 } { f_2 - f_1 } \right) / \ln(r)
\label{eq:ord-conv}
\end{equation}

\subsection{Resultado ''exacto``}
%
El resultado de una simulación numérica se puede expresar de forma general
como:

\begin{equation} \label{eq:expansion}
    f = f_{h=0} + g_1 h + g_2 h^2 + g_3 h^3 + ...
\end{equation}

Dónde $h$ es el tamaño de la malla y $g_1$, $g_2$ y $g_3$ son funciones
independientes $h$, la cantidad $f$ es considerada de segundo orden si $g1 =
0$.
%
El valor de $f_{h=0}$ es el resultado que tendría la simulación con una malla
infinitamente fina, $h \rightarrow 0$.

\subsection{Índice de convergencia de malla}
%
El índice de convergencia de malla o GCI por sus siglas en inglés es una forma
de reportar los resultados de convergencia de malla, es un indicador de qué tan
lejos se encuentran los resultados obtenidos del resultado numérico exacto
($f_{h=0}$) y surge de la siguiente ecuación:

\begin{equation} \label{eq:gci}
GCI_{i \rightarrow j} = \frac{F_S |\epsilon|}{r^p - 1}
\end{equation}

Dónde:
\begin{description}
    \item[$F_S$] es un factor de seguridad, se toma 1.25.
    \item[$\epsilon$] es el error relativo $\epsilon = (f_i - f_j) / f_j$
    \item[$r$] es el factor de refinamiento $r = h_i/h_j$
    \item[$p$] es el orden de convergencia relativo a los pasos i, j
\end{description}

De este modo, si par aun nivel de refinamiento $h_i$ la simulación da como
resultado un valor $x_i$ con $GCI_i$ dado, se puede decir que el el resutlado
de la simulación es $x_i \pm GCI_i \cdot 100$.
%
Se tomará como GCI acpetable o banda de error un valor cercano a 5\%.

\section{Resultados}
\subsection{Caso 0 - 1000rpm}

\subsection{Caso 0 - 7000 rpm}

\subsection{Caso 4 - 7000 rpm}

\subsection{Caso 5 - 1000rpm}

\subsection{Caso 5 - 7000rpm}

\subsection{Resultado final}

\end{document}
